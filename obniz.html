<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script
      src="https://unpkg.com/obniz@3.6.1/obniz.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  </head>
  <body>
    <div id="obniz-debug"></div>
    <h3>Connect From Your Browser</h3>
    <ol>
      <li id="press"><p>Not Hanging</p></li>
        <p id="lasttime1">オフラインです</p>
      <li id="press2"><p>Not Hanging</p></li>
      <p id="lasttime2">オフラインです</p>
      <li id="press3"><p>Not Hanging</p></li>
      <li id="press4"><p>Not Hanging</p></li>
      <li id="press5"><p>Not Hanging</p></li>
    </ol>

    <script>
      var obniz = new Obniz("6909-1887");
      var preVisit;
      var preHang1;

      

      obniz.onconnect = async function() {
        var pressure = obniz.wired("FSR40X", {pin0:0, pin1:1});
        var pressure2 = obniz.wired("FSR40X", {pin0:2, pin1:3});
        var pressure3 = obniz.wired("FSR40X", {pin0:4, pin1:5});
        var pressure4 = obniz.wired("FSR40X", {pin0:6, pin1:7});
        var pressure5 = obniz.wired("FSR40X", {pin0:8, pin1:9});

        var press = await pressure.getWait();

        const div = document.getElementById("press");
        const div2 = document.getElementById("press2");
        const div3 = document.getElementById("press3");
        const div4 = document.getElementById("press4");
        const div5 = document.getElementById("press5");

        obniz.display.clear();

        pressure.onchange = function(press){
          if (press > 250) {
            console.log(press)
            div.innerHTML = '<p>Hanging</p>';
            cookieArr = $.cookie();
            if (cookieArr['preHang1'] == null) {  //初訪問の時
              getNowTime();
              preHang1 = nowTime;
              courseDate(preHang1);
              $.cookie('preHang1', preHang1);
            } else {  //2回目以降の訪問の時
              preHang1 = $.cookie('preHang1');
              courseDate(preHang1);
              courseTime1 = courseTime;
            }
            $("#lasttime1").text("服がかかった状態で"+ courseTime1 +"が経過しています");
          } else {
            div.innerHTML = '<p>Not Hanging</p>';
            $.removeCookie('preHang1');
            $("#lasttime1").text("ハンガーが使用されていません");
          }
        };
        
        pressure2.onchange = function(press){
          if (press > 250) {
            console.log(press)
            div.innerHTML = '<p>Hanging</p>';
            cookieArr = $.cookie();
            if (cookieArr['preHang2'] == null) {  //初訪問の時
              getNowTime();
              preHang2 = nowTime;
              courseDate(preHang2);
              $.cookie('preHang2', preHang2);
            } else {  //2回目以降の訪問の時
              preHang2 = $.cookie('preHang2');
              courseDate(preHang2);
              courseTime2 = courseTime;
            }
            $("#lasttime2").text("服がかかった状態で"+ courseTime2 +"が経過しています");
          } else {
            div.innerHTML = '<p>Not Hanging</p>';
            $.removeCookie('preHang2');
          }
        };
        pressure3.onchange = function(press){
          if (press > 250) {
            div3.innerHTML = '<p>ON</p>';
          } else {
            div3.innerHTML = '<p>OFF</p>';
          }
        };
        pressure4.onchange = function(press){
          if (press > 250) {
            div4.innerHTML = '<p>ON</p>';
          } else {
            div4.innerHTML = '<p>OFF</p>';
          }
        };
        pressure5.onchange = function(press){
          if (press > 250) {
            div5.innerHTML = '<p>ON</p>';
          } else {
            div5.innerHTML = '<p>OFF</p>';
          }
        };
        
        

        
      };

      //現在の時間を取得する関数
      function getNowTime(){
        date = new Date();
        nowTime = date.getTime();  //現在の日時取得
      }
      //変数nからの経過時間を求める関数
      function courseDate(n){
        getNowTime();
        course = nowTime - n;
        courseTime = (Math.floor(course/(1000*60*60*24))+ "日" +Math.floor(course/(1000*60*60)%24) + "時間"
                              + Math.floor(course/(1000*60)%60) + "分" + Math.floor((course/1000) % 60) + "秒");
      }
      
    </script>
  </body>
</html>
