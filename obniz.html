<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script
      src="https://unpkg.com/obniz@3.6.1/obniz.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  </head>
  <body>
    <div id="obniz-debug"></div>
    <h3>Connect From Your Browser</h3>
    <ol>
      <li id="press1"><p>Not Hanging</p></li>
       <p id="lasttime1">オフラインです</p>
      <li id="press2"><p>Not Hanging</p></li>
       <p id="lasttime2">オフラインです</p>
      <li id="press3"><p>Not Hanging</p></li>
       <p id="lasttime3">オフラインです</p>
      <li id="press4"><p>Not Hanging</p></li>
       <p id="lasttime4">オフラインです</p>
      <li id="press5"><p>Not Hanging</p></li>
       <p id="lasttime5">オフラインです</p>
    </ol>

    <script>
      var obniz = new Obniz("6909-1887");

      obniz.onconnect = async function() {
        var pressure = obniz.wired("FSR40X", {pin0:0, pin1:1});
        var pressure2 = obniz.wired("FSR40X", {pin0:2, pin1:3});
        var pressure3 = obniz.wired("FSR40X", {pin0:4, pin1:5});
        var pressure4 = obniz.wired("FSR40X", {pin0:6, pin1:7});
        var pressure5 = obniz.wired("FSR40X", {pin0:8, pin1:9});

        var press = await pressure.getWait();

        obniz.display.clear();

        pressure.onchange = function(press){
          if (press > 250) {
            console.log(press)
            $("#press1").text("Hanging");
            cookieArr = $.cookie();
            if (cookieArr['preHang1'] == null) {
              getNowTime();
              preHang1 = nowTime;
              courseDate(preHang1);
              $.cookie('preHang1', preHang1);
              courseTime1 = 0;
            } else {
              preHang1 = $.cookie('preHang1');
              courseDate(preHang1);
              courseTime1 = courseTime;
            }
            $("#lasttime1").text("服がかかった状態で"+ courseTime1 +"が経過しています");
          } else {
            $("#press1").text("Not Hanging");
            $.removeCookie('preHang1');
            $("#lasttime1").text("ハンガーが使用されていません");
          }
        };
        pressure2.onchange = function(press){
          if (press > 250) {
            console.log(press)
            $("#press2").text("Hanging");
            cookieArr = $.cookie();
            if (cookieArr['preHang2'] == null) {
              getNowTime();
              preHang2 = nowTime;
              courseDate(preHang2);
              $.cookie('preHang2', preHang2);
              courseTime2 = 0;
            } else {
              preHang2 = $.cookie('preHang2');
              courseDate(preHang2);
              courseTime2 = courseTime;
            }
            $("#lasttime2").text("服がかかった状態で"+ courseTime2 +"が経過しています");
          } else {
            $("#press2").text("Not Hanging");
            $.removeCookie('preHang2');
            $("#lasttime2").text("ハンガーが使用されていません");
          }
        };
        pressure3.onchange = function(press){
          if (press > 250) {
            console.log(press)
            $("#press3").text("Hanging");
            cookieArr = $.cookie();
            if (cookieArr['preHang3'] == null) {
              getNowTime();
              preHang3 = nowTime;
              courseDate(preHang3);
              $.cookie('preHang3', preHang3);
              courseTime3 = 0;
            } else {
              preHang3 = $.cookie('preHang3');
              courseDate(preHang3);
              courseTime3 = courseTime;
            }
            $("#lasttime3").text("服がかかった状態で"+ courseTime3 +"が経過しています");
          } else {
            $("#press3").text("Not Hanging");
            $.removeCookie('preHang3');
            $("#lasttime3").text("ハンガーが使用されていません");
          }
        };
        pressure4.onchange = function(press){
          if (press > 250) {
            console.log(press)
            $("#press4").text("Hanging");
            cookieArr = $.cookie();
            if (cookieArr['preHang4'] == null) {
              getNowTime();
              preHang4 = nowTime;
              courseDate(preHang4);
              $.cookie('preHang4', preHang4);
              courseTime4 = 0;
            } else {
              preHang4 = $.cookie('preHang4');
              courseDate(preHang4);
              courseTime4 = courseTime;
            }
            $("#lasttime4").text("服がかかった状態で"+ courseTime4 +"が経過しています");
          } else {
            $("#press4").text("Not Hanging");
            $.removeCookie('preHang4');
            $("#lasttime4").text("ハンガーが使用されていません");
          }
        };     
        pressure5.onchange = function(press){
          if (press > 250) {
            console.log(press)
            $("#press5").text("Hanging");
            cookieArr = $.cookie();
            if (cookieArr['preHang5'] == null) {
              getNowTime();
              preHang5 = nowTime;
              courseDate(preHang5);
              $.cookie('preHang5', preHang5);
              courseTime5 = 0;
            } else {
              preHang5 = $.cookie('preHang5');
              courseDate(preHang5);
              courseTime5 = courseTime;
            }
            $("#lasttime5").text("服がかかった状態で"+ courseTime5 +"が経過しています");
          } else {
            $("#press5").text("Not Hanging");
            $.removeCookie('preHang5');
            $("#lasttime5").text("ハンガーが使用されていません");
          }
        };
             
      };

      //現在の時間を取得する関数
      function getNowTime(){
        date = new Date();
        nowTime = date.getTime();  //現在の日時取得
      }
      //変数nからの経過時間を求める関数
      function courseDate(n){
        getNowTime();
        course = nowTime - n;
        courseTime = (Math.floor(course/(1000*60*60*24))+ "日" +Math.floor(course/(1000*60*60)%24) + "時間"
                              + Math.floor(course/(1000*60)%60) + "分" + Math.floor((course/1000) % 60) + "秒");
      }
      
    </script>
  </body>
</html>
